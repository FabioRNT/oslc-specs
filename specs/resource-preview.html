<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'/>
<script src='https://sspeiche.github.io/respec/builds/oasis/respec-oasis-common.js' async class='remove'></script>
<script class='remove'>
  var respecConfig = {
      specStatus:           "CS",
      edDraftURI:           "resource-preview.html",

      // the specification's short name, as in http://www.w3.org/TR/short-name/
      shortName:            "OSLC 3.0 Resource Preview",

      // if your specification has a subtitle that goes below the main
      // formal title, define it here
      // subtitle   :  "an excellent document",

      // if you wish the publication date to be other than the last modification, set this
      // publishDate:  "2009-08-06",

      // if the specification's copyright date is a range of years, specify
      // the start date here:
      // copyrightStart: "2005"

      // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
      // and its maturity status
      // previousPublishDate:  "1977-03-15",
      // previousMaturity:  "WD",

      // if there a publicly available Editor's Draft, this is the link
      // edDraftURI:           "http://berjon.com/",

      // if this is a LCWD, uncomment and set the end of its review period
      // lcEnd: "2009-08-05",

      // editors, add as many as you like
      // only "name" is required
      editors:  [
          {
              name:       "Samuel Padgett"
          ,   mailto:     "spadgett@us.ibm.com"
          ,   company:    "IBM"
          ,   companyURL: "http://ibm.com/"
          },
          {
              name:       "Steve Speicher"
          ,   url:        "http://stevespeicher.me/"
          ,   mailto:     "sspeiche@us.ibm.com"
          ,   company:    "IBM"
          ,   companyURL: "http://ibm.com/"
          }
      ],

      previousURI: "http://open-services.net/bin/view/Main/OslcCoreUiPreview",
      prevED: "http://open-services.net/wiki/core/User-Interface-Previews-3.0/",

      // name of the WG
      wg:           "OASIS OSLC Lifecycle Integration Core (OSLC Core) TC",

      // URI of the public WG page
      wgURI:        "https://www.oasis-open.org/apps/org/workgroup/oslc-core/",

      // name (without the @w3c.org) of the public mailing to which comments are due
      wgPublicList: "oslc-core",

      // URI of the patent status for this WG, for Rec-track documents
      // !!!! IMPORTANT !!!!
      // This is important for Rec-track documents, do not copy a patent URI from a random
      // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
      // Team Contact.
      wgPatentURI:  "",
      // !!!! IMPORTANT !!!! MAKE THE ABOVE BLINK IN YOUR HEAD
        localBiblio:  {
                "OSLCUIPreview20": {
                        title:    "OSLC Core 2.0 - UI Preview",
                        href:     "http://open-services.net/bin/view/Main/OslcCoreUiPreview",
                        authors:  [
                                "S. Bosworth"
                        ],
                        status:   "Finalized",
                        publisher:  "http://open-services.net"
                 }
        }
  };
</script>
<title>Open Services for Lifecycle Collaboration Resource Preview Specification 3.0</title>
<style type="text/css">
table, thead, tr, td {
    padding: 5px;
    border-width: 1px;
    border-spacing: 0px;
    border-style: solid;
    border-collapse: collapse;
}

td {
    min-width: 100px;
}

div.review {
    border-color: #E05252;
    background: #FBE9E9;
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
    border-left-width: .5em;
    border-left-style: solid;
}
</style>
</head>
<body>

<section id="abstract">
<p>This document outlines a technique used to show a user in-context
    information when displaying a link to a resource and then show more
    detailed preview when the user gestures.</p>
</section>

<section class="informative" id="introduction">

<h2>Introduction</h2>

<p>This document outlines a technique used to show a user in-context
    information when displaying a link to a resource and then show more
    detailed preview when the user gestures. What gesture triggers a preview is
    up to the client and can vary by implementation or device. For example, it
    might be triggered by the user hovering his mouse cursor over the link in a
    web application.</p>

<p>This specification describes a mechanism that enables client applications,
    given only the URI of a resource, to discover helpful information for
    presenting in-context links and previews of that resource. The approach

    <ol>
        <li>Acknowledges that a resource may refer to other resources of
            arbitrary types, and
        <li>Does not require the client to know much about the particular
            details of those resources.
    </ol>
</p>

</section>

<div class="review">
    We are experimenting with some changes to the specification, based on current
    goals of OSLC Core and experiences from previous specification development and
    alignment with W3C LDP [[LDP]].
    <ul>
        <li>Separate <a href="#vocab">vocabulary terms</a> from <a
                    href="#shapes">resource tables/shapes</a></li>
        <li>A more comprehensive introduction, with samples, so readers "get the gist"
            without having to consume the entire spec and depend on primer</li>
        <li>A dedicated primer</li>
        <li>Separating each requirement into its own numbered section like LDP 1.0</li>
        <li>Separating "guidance" and "best practices" into a separate non-normative
            document, allows for cleaner separation and ease of updating</li>
    </ul>
</div>

<section id="sotd">Early Working Draft</section>

<section id="terminology">
<h2>Terminology</h2>

<p>The following terms are used in discussions of previews:</p>

<dl class="glossary">
    <dt>Consumer</dt>
    <dd>A web application displaying a link to a resource.</dd>
    <dt>Provider</dt>
    <dd>A server that offers Consumers information for displaying the
        link to a resource and rich previews of the resource.</dd>
</dl>

</section>

<section class='informative' id="conceptualmodel">
<h2>Conceptual Model</h2>

<p>To enable previews of a target resource, a Provider supplies a Compact
    resource describing the preview. The Consumer performs an HTTP GET request
    to the target resource's URI using the HTTP Prefer header
    <code>return=representation</code> preference [[!RFC7240]] and an
    <code>include</code> parameter [[!LDP]] asking for the Compact resource. If
    the Provider supports previews, it inlines a Compact resource in the
    response.</p>
</section>

<section id="resources">
<h2>Resources</h2>

<p>Providers <strong>MUST</strong> support the <code>application/json</code> [[RFC4627]]
    and <code>text/turtle</code> [[turtle]] media types for the Compact resource. They
    <strong>SHOULD</strong> support the <code>application/ld+json</code> media
    type [[JSON-LD]]. The
    <code>application/json</code> Compact resource representation
    <strong>MUST</strong> be in the JSON format described in <a
            href="#JSON_Representation_Format">JSON Representation Format</a>
    below. The JSON property names for the <code>application/json</code>
    responses are included in the table below.</p>

<section id="vocab">
<h2>Terms</h2>
<p>This section highlights the new RDF vocabulary terms defined in this specification.</p>
<h3>Properties:</h3>
<table>
<thead>
<tr>
        <th>Property</th>
        <th>Value-type</th>
        <th>Description</th>
</tr>
</thead>

<tbody>
<tr>
        <td><code>oslc:compact</code></td>
        <td>Resource</td>
        <td>An associated <code>oslc:Compact</code> resource that describes how
            to display a preview.</td>
</tr>
<tr>
        <td><code>oslc:shortTitle</code></td>
        <td>String</td>
        <td>Abbreviated title which may be used in the display of a link to the
            resource. The value SHOULD include only content that is valid
            inside an HTML &lt;span&gt; element [[HTML5]]. Providers SHOULD include an
            abbreviated title for the resource when possible. The abbreviated
            title is typically shown to a user as a hyperlink in presentations
            where visual space is limited. As a general guideline, the length
            of the abbreviated title SHOULD be 5 characters or less. A
            user-visible identifier that ordinarily appears in the
            dcterms:title, such as a defect number, makes for a good
            <code>oslc:shortTitle</code> value. When a resource has no obvious
            identifier or handle, Providers SHOULD omit the
            <code>oslc:shortTitle</code> property. Providers MUST first HTML
            escape the contents of the <code>oslc:shortTitle</code> before
            sending the response.</td>
</tr>
<tr>
        <td><code>oslc:icon</code></td>
        <td>Resource</td>
        <td>URI of an image which may be used in the display of a link to the
            resource.</td>
</tr>
<tr>
        <td><code>oslc:iconAltLabel</code></td>
        <td>String</td>
        <td>Alternative label used in association with the
            <code>oslc:icon</code>, such as HTML <code>img</code> tag's
            <code>alt</code> attribute.</td>
</tr>
<tr>
        <td><code>oslc:iconTitle</code></td>
        <td>String</td>
        <td>Title used in association with the <code>oslc:icon</code>, such as
            HTML <code>img</code> tag's <code>title</code>
            attribute.</td>
</tr>
<tr>
        <td><code>oslc:smallPreview</code></td>
        <td>Local Inline Resource of type <code>oslc:Preview</code></td>
        <td>URI and sizing properties for an HTML document to be used for a
            small preview.</td>
</tr>
<tr>
        <td><code>oslc:largePreview</code></td>
        <td>Local Inline Resource of type <code>oslc:Preview</code></td>
        <td>URI and sizing properties for an HTML document to be used for a
            large preview.</td>
</tr>
</tbody>
</table>

<h3>Classes</h3>
<table>
<thead>
<tr>
        <th>Class</th>
        <th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<tr>
        <td><code>oslc:Compact</code></td>
        <td>description</td>
</tr>
</tbody>
</table>
</section>

<section id="shapes">
<h2>Shapes</h2>

<p><strong>Name</strong>: Compact</p>

<p><strong>Class URI</strong>:
    <a href="http://open-services.net/ns/core#Compact">http://open-services.net/ns/core#Compact</a></p>

<p><strong>Properties</strong>:</p>

<table>
<thead>
<tr>
        <th>Property</th>
        <th>JSON Property</th>
        <th>Value-type</th>
        <th>Occurs</th>
        <th>Description</th>
</tr>
</thead>

<tbody>
<tr>
        <td><code>dcterms:title</code></td>
        <td><code>title</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Title that may be used in the display of a link to the resource.
            The value SHOULD include only content that is valid inside an HTML
            &lt;span&gt; element. Providers SHOULD include a
            <code>dcterms:title</code> property with an informative label for
            the resource. The title is typically shown to a user as a
            hyperlink.  For a resource with no obvious title, Providers SHOULD
            omit the <code>dcterms:title</code> property. Providers MUST first
            HTML escape the contents of the <code>dcterms:title</code> before
            sending the response.</td>
</tr>
<tr>
        <td><code>oslc:shortTitle</code></td>
        <td><code>shortTitle</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Abbreviated title which may be used in the display of a link to the
            resource. The value SHOULD include only content that is valid
            inside an HTML &lt;span&gt; element. Providers SHOULD include an
            abbreviated title for the resource when possible. The abbreviated
            title is typically shown to a user as a hyperlink in presentations
            where visual space is limited. As a general guideline, the length
            of the abbreviated title SHOULD be 5 characters or less. A
            user-visible identifier that ordinarily appears in the
            dcterms:title, such as a defect number, makes for a good
            <code>oslc:shortTitle</code> value. When a resource has no obvious
            identifier or handle, Providers SHOULD omit the
            <code>oslc:shortTitle</code> property. Providers MUST first HTML
            escape the contents of the <code>oslc:shortTitle</code> before
            sending the response.</td>
</tr>
<tr>
        <td><code>oslc:icon</code></td>
        <td><code>icon</code></td>
        <td>Resource</td>
        <td>Zero-or-one</td>
        <td>URI of an image which may be used in the display of a link to the
            resource.</td>
</tr>
<tr>
        <td><code>oslc:iconAltLabel</code></td>
        <td><code>iconAltLabel</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Alternative label used in association with the
            <code>oslc:icon</code>, such as HTML <code>img</code> tag's
            <code>alt</code> attribute.</td>
</tr>
<tr>
        <td><code>oslc:iconTitle</code></td>
        <td><code>iconTitle</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Title used in association with the <code>oslc:icon</code>, such as
            HTML <code>img</code> tag's <code>title</code>
            attribute.</td>
</tr>
<tr>
        <td><code>oslc:smallPreview</code></td>
        <td><code>smallPreview</code></td>
        <td>Local Inline Resource of type <code>oslc:Preview</code></td>
        <td>Zero-or-one</td>
        <td>URI and sizing properties for an HTML document to be used for a
            small preview.</td>
</tr>
<tr>
        <td><code>oslc:largePreview</code></td>
        <td><code>largePreview</code></td>
        <td>Local Inline Resource of type <code>oslc:Preview</code></td>
        <td>Zero-or-one</td>
        <td>URI and sizing properties for an HTML document to be used for a
            large preview.</td>
</tr>
</tbody>
</table>

<h2 id="resourcePreview">Resource: Preview</h2>

<p><strong>Name</strong>: Preview</p>

<p><strong>Type URI</strong>: <a href="http://open-services.net/ns/core#Preview">http://open-services.net/ns/core#Preview</a></p>

<p><strong>Properties</strong>:</p>

<table>
<thead>
<tr>
        <th>Property</th>
        <th>JSON Property</th>
        <th>Value-type</th>
        <th>Occurs</th>
        <th>Description</th>
</tr>
</thead>

<tbody>
<tr>
        <td><code>oslc:document</code></td>
        <td><code>document</code></td>
        <td>Resource</td>
        <td>Exactly-one</td>
        <td>The URI of an HTML document to be used for the preview.</td>
</tr>
<tr>
        <td><code>oslc:hintWidth</code></td>
        <td><code>hintWidth</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Recommended width of the preview. Values <strong>MUST</strong> be
            expressed using length units as specified in [[CSS21]].</td>
</tr>
<tr>
        <td><code>oslc:hintHeight</code></td>
        <td><code>hintHeight</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Recommended height of the preview. Values <strong>MUST</strong> be
            expressed using length units as specified in [[CSS21]].</td>
</tr>
</tbody>
</table>

</section>
</section>

<section id="discovery">
<h2>Compact Resource Discovery</h2>

Consumers <strong>MAY</strong> discover Compact resources in one of two ways:

<ol>
<li><a href="#prefer">Discovering Compact Resources Using the HTTP Prefer Header</a>, or</li>
<li><a href="#linkHeader">Discovering Compact Resources Using the HTTP Link Header</a></li>
</ol>

<section id="prefer"> <h2>Discovering Compact Resources Using the HTTP Prefer
        Header</h2>

<p>Consumers <strong>MAY</strong> request the preview of a resource by making
    an HTTP GET request to the target resource's URI using the
    <code>return=representation</code> preference of the HTTP Prefer request
    header [[!RFC7240]] and <code>include</code> parameter [[LDP]] value
    <code>http://open-services.net/ns/core#PreferCompact</code>.  Providers
    supporting resource preview <strong>MUST</strong> support this method of
    discovery for resources with RDF or JSON representations.</p>

<strong>Example Request:</strong>

<pre class="example" id="preferExample">
GET /bugs/324 HTTP/1.1
Host: example.com
Accept: application/json
Prefer: return=representation; include="http://open-services.net/ns/core#PreferCompact"
</pre>

<p>If the provider supports a preview for this resource and the request is
    successful, the response <strong>MUST</strong> include the Compact resource
    in its body.</p>

<p>The response content type is negotiated using the HTTP <code>Accept</code>
    request header. If the negotiated content type is
    <code>application/json</code>, the response body <strong>MUST</strong> be a
    JSON object. The top-level JSON object <strong>MUST</strong> have a
    <code>compact</code> property whose value is the JSON object describing the
    Compact resource in the <a href="#JSON_Representation_Format">JSON
        Representation Format</a>. The JSON <strong>MAY</strong> include other
    properties.</p>

<strong>Example JSON Response:</strong>

<pre class="example" id="preferenceAppliedExample">
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8
ETag: W/"f9d76afe5fbed1655c5768906db8958a"
Link: &lt;http://www.w3.org/ns/ldp#Resource&gt;; rel="type"
Preference-Applied: return=representation
Vary: Accept,Prefer
Allow: GET,HEAD,OPTIONS,PUT,DELETE

{
    "compact": {
        "title": "324: Need a fix &lt;em&gt;NOW&lt;/em&gt;",
        "icon": "http://example.com/icons/defect.jpg",
        "largePreview": {
            "document": "http://example.com/bugs/324?preview=large",
            "hintHeight": "250px",
            "hintWidth": "400px"
        }
    }
}
</pre>

<p>Including a JSON-LD context in an <code>application/json</code> response is
    <strong>OPTIONAL</strong>. Consumers who prefer RDF <strong>SHOULD</strong>
    request <code>text/turtle</code> or <code>application/ld+json</code> using
    the HTTP <code>Accept</code> request header rather than
    <code>application/json</code>.</p>

<strong>Example JSON Response with JSON-LD Context:</strong>

<pre class="example" id="preferenceAppliedJsonLDExample">
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8
ETag: W/"d53d19be87fa9c61043c70bd91413dab"
Link: &lt;http://www.w3.org/ns/ldp#Resource&gt;; rel="type"
Preference-Applied: return=representation
Vary: Accept,Prefer
Allow: GET,HEAD,OPTIONS,PUT,DELETE

{
    "@id": "http://example.com/bugs/324",
    "@type": "http://example.com/ns#Bug",
    "@context": "http://example.com/contexts/preview.jsonld",
    "compact": {
        "@id": "http://example.com/bugs/324?compact",
        "@type": "http://open-services.net/ns/core#Compact",
        "title": "324: Need a fix &lt;em&gt;NOW&lt;/em&gt;",
        "shortTitle": "324",
        "icon": "http://example.com/icons/defect.jpg",
        "iconTitle": "Defect",
        "iconAltLabel": "Defect",
        "largePreview": {
            "document": "http://example.com/bugs/324?preview=large",
            "hintHeight": "250px",
            "hintWidth": "400px"
        },
        "smallPreview": {
            "document": "http://example.com/bugs/324?preview=small"
        }
    }
}
</pre>

<p>Consumers <strong>SHOULD</strong> inspect the response body for the Compact
    resource even if the <code>Preference-Applied</code> response header is
    missing. Some providers might omit the <code>Preference-Applied</code>
    header as discussed in [[RFC7240]].</p>

<p>Providers <strong>MAY</strong> choose to only provide previews for some
    resources and not others. Providers <strong>SHOULD</strong> provide
    Compact resources for resources that other applications or resources
    ordinarily refer to, however. If a resource does not exist or is not
    accessible to the requesting Consumer, the Provider <strong>MUST</strong>
    return the same 4xx status code that it would have returned had the
    Consumer instead requested the resource itself.</p>

<p>Consumers <strong>SHOULD</strong> gracefully handle unsuccessful attempts to
    use the preview mechanism; unsuccessful attempts should never result in
    failure in the way a Consumer application operates or performs.  Consumers
    <strong>SHOULD</strong> anticipate that the preview mechanism may not be
    supported for a resource, or that the preview mechanism may not work due to
    security or service availability issues, or even that preview capability
    once supported by a Provider has been phased out.</p>

<p>Providers <strong>SHOULD</strong> include a <code>Vary</code> response
    header that includes both <code>Accept</code> and <code>Prefer</code> for
    requests on any resource that supports preview.  <code>Vary</code> allows a
    cache to properly interpret future requests on the resource and informs the
    browser that the cacheable response is subject to server-driven
    negotiation.</p>

<p>Providers <strong>MAY</strong> consult the <code>Accept-Language</code>
    field on requests for a Compact representation of the resource (and on
    requests for rich preview documents) and return a representation for the
    requested natural language.</p>
</section>

<section id="linkHeader"> <h2>Discovering Compact Resources Using the HTTP Link
        Header</h2>

<p>On responses to HTTP requests for existing resources, such as GET requests,
    Providers <strong>MAY</strong> include a <code>Link</code> header
    [[RFC5988]] for resources that support preview where

    <ul>
        <li>The context URI is the effective request URI,</li>
        <li>The link relation is
            <code>http://open-services.net/ns/oslc#Compact</code>, and</li>
        <li>The target URI is the URI of the Compact resource.</li>
    </ul>

    The <code>Link</code> header allows providers to support preview for
    resources that have neither RDF nor JSON representations such as binary
    resources, although it can be used for any resource that supports
    preview.</p>

<strong>Example Request:</strong>

<pre class="example" id="linkHeaderRequest">
HEAD /bugs/324/screenshot HTTP/1.1
Host: example.com
</pre>

<strong>Example Response:</strong>

<pre class="example" id="linkHeaderResponse">
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Content-Type: image/png
ETag: W/"678609cdee68e0fb8aea5f252b84a511"
Link: &lt;http://example.com/bugs/324/screenshot?compact&gt;; rel="http://open-services.net/ns/oslc#Compact",
      &lt;http://www.w3.org/ns/ldp#Resource&gt;; rel="type"
Vary: Accept,Prefer
Allow: GET,HEAD,OPTIONS,PUT,DELETE
</pre>

<p>Consumers can request the Compact resource using the target URI of the
    <code>Link</code> header.</p>

<strong>Example Request:</strong>

<pre class="example" id="linkHeaderRequest">
GET /bugs/324/screenshot?compact HTTP/1.1
Host: example.com
Accept: application/json
</pre>

<strong>Example Response:</strong>

<pre class="example" id="linkHeaderResponse">
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8
ETag: W/"3bf6fbc90e11b3c2cc30acb534b452ea"
Link: &lt;http://www.w3.org/ns/ldp#Resource&gt;; rel="type"
Vary: Accept
Allow: GET,HEAD,OPTIONS

{
    "title": "Screenshot of the problem",
    "shortTitle": "screenshot.png",
    "smallPreview": {
        "document": "http://example.com/bugs/324/screenshot?preview=small"
    }
}
</pre>

<p>Providers <strong>MAY</strong> return a <code>Link</code> header in
    successful responses to creation requests where

    <ul>
        <li>The context URI is the URI of the newly-created resource,</li>
        <li>The link relation is
            <code>http://open-services.net/ns/oslc#Compact</code>, and</li>
        <li>The target URI is the URI of the Compact resource.</li>
    </ul>

    This allows the consumers to discover the associated Compact resource URI
    without making additional requests.</p>

<strong>Example Request:</strong>

<pre class="example" id="postLinkHeaderRequest">
POST /bugs HTTP/1.1
HOST: example.com
Content-Type: text/turtle
Content-Length: 153

@prefix dcterms: &lt;http://purl.org/dc/terms/&gt; .

&lt;&gt;      a              &lt;http://example.com/ns#Bug&gt; ;
        dcterms:title  "Something went wrong" .
</pre>

<strong>Example Response:</strong>

<pre class="example" id="postLinkHeaderResponse">
HTTP/1.1 201 Created
Location: http://example.com/bugs/478
Link: &lt;http://example.com/bugs/478?compact&gt;; rel="http://open-services.net/ns/oslc#Compact"; anchor="http://example.com/bugs/478",
      &lt;http://www.w3.org/ns/ldp#Resource&gt;; rel="type"
Content-Length: 0
</pre>
</section>

<section id="display">
<h2>Displaying a Preview</h2>

<p>The following guidance is suggested for Consumer display of a resource link
    and rich previews. For purposes of this discussion, assume source resource
    A has a URI property that refers to target resource B:</p>

<section id="navigating">
<h2>Navigation to the target resource</h2>

<p>At any time, the user <strong>SHOULD</strong> be able to gesture that they
    would like to navigate the link to the target resource, regardless of how
    the link to the target resource happens to be rendered. </p>
</section>

<section id="displayingLinks">
<h2>Default way to display the link to the target resource</h2>

<p>The typical way for forming and displaying the hyperlink
    <strong>SHOULD</strong> be based on information that is stored locally in
    source resource A (or that is generally known to the Consumer). Generally,
    link text can be derived from property values of resource A, and
    potentially from a string or literal property value in the reference to the
    target resource B, if such a property exists. Because these property values
    are part of the representation of the source resource A, they are available
    without consulting the target resource, and will be available even if the
    target resource B cannot be fetched.  When available, Consumers
    <strong>SHOULD</strong> display this string (as opposed to the URI) when
    presenting resource A to indicate a potential navigation to resource B.
    This is the basic presentation of a link to target resource B.</p>

<p>The default display of the link from A to B is visible to any user
    authorized to access resource A. The use of Compact representation
    information described below is only viable for users who are also
    authorized to access resource B.</p>
</section>

<section id="usingTitle">
<h2>Using the Compact representation title, short title, and icon</h2>

<p>A Compact representation of the resource may contain a more accurate and
    slightly richer label for a target resource ( <code>dcterms:title</code>
    element), a short-form title for the resource (
    <code>oslc:shortTitle</code>), and a corresponding image (
    <code>oslc:icon</code>), all of which may be based on the current state of
    the target resource. If this becomes known to the Consumer, the Consumer
    <strong>SHOULD</strong> assume that this information is better and use it
    in forming the hyperlink that is displayed to the user. When available,
    <code>oslc:shortTitle</code> MAY be used instead of
    <code>dcterms:title</code> in presentations where visual space is severely
    limited.</p>

<p>Consumers <strong>SHOULD NOT</strong> fetch Compact representations when
    there is perfectly usable default display information available. When
    designing a Consumer application, consideration should be given to the
    potential benefits of obtaining an improved title and icon for the target
    resource against the costs of preemptively fetching the Compact
    representation in terms of added load on servers and networks (which might
    only be apparent to users on slow networks or heavily loaded servers).</p>

<p>Consumers <strong>SHOULD</strong> be wary of material obtained from
    non-trusted sources; in particular, the Consumer <strong>SHOULD</strong> check that
    the dcterms:title and oslc:shortTitle property values do not contain HTML
    markup beyond the specified set of simple elements.</p>
</section>

<section id="smallPreview">
<h2>Displaying a small preview</h2>

<p>If a user mouses or hovers over a displayed link, the Consumer
    <strong>SHOULD</strong> determine whether the target resource has a small
    preview (<code>oslc:smallPreview</code>). If it does, the Consumer
    <strong>SHOULD</strong> present the small preview document in a hovering
    widget.  Since preview documents may contain arbitrary content, including
    HTML and scripts, Consumers <strong>MUST</strong> use iframes if embedding
    the preview document inside another HTML-based presentation.</p>

<p>The Consumer <strong>SHOULD NOT</strong> attempt to prefetch a Compact
    representation just to have the preview URIs in hand so that the hover can
    come up faster. There is a low chance that the user will make a gesture
    that would call for the display of a small preview. It would generally be a
    poor tradeoff to increase overall system load just to decrease UI latency
    for low probability eventualities.</p>
</section>

<section id="largePreview">
<h2>Displaying a large preview</h2>

<p>If the user then gestures that they want to see a bit more of the resource,
    the Consumer should determine whether the target resource has a large
    preview ( <code>oslc:largePreview</code>). If it does, the Consumer
    <strong>SHOULD</strong> present the large preview document in a stationary
    widget that permits further user interaction. Again, since preview
    documents may contain arbitrary content, including HTML and scripts,
    Consumers <strong>MUST</strong> use iframes if embedding the preview
    document inside another HTML-based presentation.</p>
</section>

<section id="sizing">
<h2>Preview sizing</h2>

<p>The Compact resource <strong>MAY</strong> include
    <code>oslc:hintHeight</code> and <code>oslc:hintWidth</code> properties for
    each preview. Values for <code>oslc:hintWidth</code> and
    <code>oslc:hintHeight</code> MUST be expressed in <strong><em>length
            units</em></strong> as specified in the <a
                    href="http://www.w3.org/TR/CSS2/">W3C Cascading Style
                Sheets Specification (CSS 2.1)</a>. Providers
    <strong>MAY</strong> support dynamic resizing for small and large
    previews in addition to <code>oslc:hintHeight</code> and
    <code>oslc:hintWidth</code>.</p>

<p>When the resource does not supply preferred sizing for a preview, the
    Consumer <strong>SHOULD</strong> default to a reasonably generous value.
    The default value a Consumer uses <strong>MAY</strong> be different for
    different window and screen sizes.</p>

<p>The communication of dynamic preview size information happens within a web
    browser. JavaScript code running in the preview iframe sends a message that
    is received and acted upon by JavaScript code running in the iframe's
    parenting window. This cross-frame communication is done using HTML 5
    <code>postMessage</code>. Dyanmic resizing will not work inside browsers
    that do not support <code>postMessage</code>.</p>

<p>A dynamic preview resize message consists of the characters
    <code>oslc-resize:</code> followed by a JSON object describing the
    dimensions using properties <code>oslc:hintHeight</code> and
    <code>oslc:hintWidth</code>.</p>

<table>
<thead>
<tr>
        <th>JSON Property Name</th>
        <th>Type</th>
        <th>Occurs</th>
        <th>Description</th>
</tr>
</thead>

<tbody>
<tr>
        <td><code>oslc:hintHeight</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Preferred height of the preview. Values <strong>MUST</strong>
            be expressed using length units as specified in [[CSS21]].</td>
</tr>
<tr>
        <td><code>oslc:hintWidth</code></td>
        <td>String</td>
        <td>Zero-or-one</td>
        <td>Preferred width of the preview. Values <strong>MUST</strong>
            be expressed using length units as specified in [[CSS21]].</td>
</tr>
</tbody>
</table>

<p>For example, the following message requests that the preview be resized to
    height of 277 pixels and a width of 400 pixels.</p>

<pre class="example" id="oslcPreviewHeightExample">
    oslc-resize:{"oslc:hintHeight": "277px", "oslc:hintWidth": "400px"}
</pre>

<p>The source of the event <strong>MUST</strong> be the preview's window.</p>

<p>Here is a JavaScript example that sends a preview resize request:</p>

<pre class="example" id="postMessageExample">
var size = {
    'oslc:hintHeight': '277px',
    'oslc:hintWidth': '400px'
};

if (window.postMessage &amp;&amp; window.parent)  {
    window.parent.postMessage('oslc-resize:' + JSON.stringify(size), "*");
}
</pre>

<p>Consumers <strong>SHOULD</strong> honor a preview's ability to dynamic
    resize, but are under no obligation to do so. Provider <strong>MAY</strong>
    send more than one resize request. Consumers <strong>MAY</strong> locally
    cache the last known dynamic height and width for recently shown preview
    URLs and use the cached dimensions for a preview in preference to its
    <code>oslc:hintHeight</code> and <code>oslc:hintWidth</code> to minimize
    redraw.</p>
</section>

</section>

<section id="jsonFormat">
<h2 id="JSON_Representation_Format">JSON Representation Format</h2>

<p>A Compact resource JSON representation might look like the following for the
    target resource <code>http://example.com/bugs/324</code>:</p>

<pre class="example" id="compactExample">
{
    "title": "324: Need a fix &lt;em&gt;NOW&lt;/em&gt;",
    "shortTitle": "324",
    "icon": "http://example.com/icons/defect.jpg",
    "iconTitle": "Defect",
    "iconAltLabel": "Defect",
    "largePreview": {
        "document": "http://example.com/bugs/324?preview=large",
        "hintHeight": "250px",
        "hintWidth": "400px"
    },
    "smallPreview": {
        "document": "http://example.com/bugs/324?preview=small"
    }
}
</pre>

<p>The JSON representation has the following constraints:</p>

<ul>
    <li>The value of the <code>title</code> or <code>shortTitle</code>
        properties <strong>MUST</strong>, if present, only contain markup valid
        in an HTML <code>span</code> element. To afford clients the greatest
        flexibility to style the text to match the context in which it is being
        displayed, the titles <strong>SHOULD</strong> be plain text with HTML
        markup used only to emphasize words or phrases or to convey additional
        information about the target resource.</li>
    <li><code>icon</code>, if present, <strong>MUST</strong> be the URI of an image. The
        image <strong>SHOULD</strong> be square. A consumer
        <strong>MAY</strong> scale the image as needed.</li>
    <li><code>iconAltLabel</code> and <code>iconTitle</code>, if present,
        <strong>MUST</strong> only have string content with no markup.</li>
    <li><code>smallPreview</code> and <code>largePreview</code>, if present,
        <strong>MAY</strong> have any number of properties, including none.
        <ul>
            <li>The value of <code>smallPreview</code> and <code>largePreview</code>, if
                present, <strong>MUST</strong> be the JSON representation of an
                <code>oslc:Preview.</code>

                <ul>
                    <li>A <code>Preview</code> <strong>MAY</strong> have any
                        number of properties, but must include a
                        <code>document</code> property.</li>
                    <li><code>document</code> <strong>MUST</strong> be the URI of a document
                        containing a preview of the resource.</li>
                    <li><code>hintWidth</code> and <code>hintHeight</code>, if
                        present, <strong>MUST</strong> be expressed using
                        length units as specified in [[CSS21]].</li>
                </ul>
            </li>
        </ul>
    </li>
    <li><p>All resources <strong>MAY</strong> have additional properties not
        specified here. Consumers <strong>MUST</strong> quietly ignore unknown elements
        and attributes encountered in a Compact representation.</p></li>
</ul>

<p>Providers <strong>MAY</strong> respond with JSON-LD in <a
            href="http://www.w3.org/TR/json-ld/#compacted-document-form">compacted
        document form</a> when consumers request the
    <code>application/json</code> media type as long as the response meets the
    above requirements for the JSON format.<p>

<p>Here is an example JSON-LD context for a Compact resource:</p>

<pre class="example" id="jsonldExample">
{
    "title": "http://purl.org/dc/terms/title",
    "shortTitle": "http://open-services.net/ns/core#shortTitle",
    "iconTitle": "http://open-services.net/ns/core#iconTitle",
    "iconAltLabel": "http://open-services.net/ns/core#iconAltLabel",
    "compact": {
        "@id": "http://open-services.net/ns/core#compact",
        "@type": "@id"
    },
    "hintHeight": "http://open-services.net/ns/core#hintHeight",
    "hintWidth": "http://open-services.net/ns/core#hintWidth",
    "icon": {
        "@id": "http://open-services.net/ns/core#img",
        "@type": "@id"
    },
    "src": {
        "@id": "http://open-services.net/ns/core#src",
        "@type": "@id"
    },
    "largePreview": {
        "@id": "http://open-services.net/ns/core#largePreview",
        "@type": "http://open-services.net/ns/core#Preview"
    },
    "smallPreview": {
        "@id": "http://open-services.net/ns/core#smallPreview",
        "@type": "http://open-services.net/ns/core#Preview"
    },
    "document": {
        "@id": "http://open-services.net/ns/core#document",
        "@type": "@id"
    }
}
</pre>
</p>
</section>
</section>

<section class="appendix">
<h2 id="backwardscompatibility">Backwards Compatibility</h2>

<p>Providers <strong>MAY</strong> continue to support to OSLC 2.0
    <code>application/x-oslc-compact+xml</code> media type and Compact
    representation for compatibility with OSLC 2.0 consumers. See <a
            href="http://open-services.net/bin/view/Main/OslcCoreUiPreview">OSLC
        2.0 UI Preview</a> [[OSLCUIPreview20]].</p>
</section>

<!--
<section class="appendix">
<h2 id="references">References</h2>

<ul>
    <li>Previous UI Preview Specification - <a href="http://open-services.net/bin/view/Main/OslcCoreUiPreview">OSLC 2.0 UI Preview</a></li>
    <li>LDP - <a href="http://www.w3.org/TR/ldp/">Linked Data Platform 1.0 (Candidate Recommendation)</a></li>
    <li>CSS - <a href="http://www.w3.org/TR/CSS2/">Cascading Style Sheets Level 2 Revision 2 v2.1</a></li>
    <li>Dublin Core - <a href="http://dublincore.org/documents/dces/">Dublin Core Metadata Element Set, Version 1.1</a></li>
    <li>HTML5 Posting Message - <a href="http://www.w3.org/TR/html5/comms.html#posting-messages">W3C HTML5 postMessage</a></li>
    <li>HTTP - <a href="http://tools.ietf.org/html/rfc2616">Hyper-text Transfer Protocol (HTTP/1.1)</a></li>
    <li>JSON-LD - <a href="http://www.w3.org/TR/json-ld/">JSON-LD 1.0</a></li>
    <li>Prefer - <a href="http://tools.ietf.org/html/draft-snell-http-prefer-18">Prefer Header for HTTP</a></li>
    <li>Strawman Proposal - <a href="https://jazz.net/wiki/bin/view/Main/LinkRendering">IBM Jazz Compact Rendering 1.0</a></li>
    <li>Window Object - <a href="http://www.w3.org/TR/Window/#window-embedding">Window Object 1.0 Window.name</a></li>
    <li>XSD Datatypes - <a href="http://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a></li>
</ul>
</section>
 -->

<section class="appendix informative" id="history">
<h2>Change History</h2>
<p>Below is a summary of some of the changes in this draft</p>

<ul>
    <li>2014-08-29 Clarify use of Preference-Applied and Link headers. (SP)</li>
    <li>2014-08-26 Discuss preview for resources with no RDF. (SP)</li>
    <li>2014-08-21 Use Prefer: return=representation with an include parameter
        instead of type=oslc-compact. (SP)</li>
    <li>2014-08-20 Started to convert to respec-style references. (SS)</li>
    <li>2014-08-19 Added sections for separate terms and shapes, also proposed
        doc structure changes. (SS)</li>
    <li>2014-08-18 Add a minimal JSON example. (SP)</li>
    <li>2014-08-15 Update Prefer discovery method and use oslc:resize.
        (SP)</li>
    <li>2014-05-01 Use ReSpec. (SP)</li>
    <li>2014-03-28 Initial draft. (SP)</li>
</ul>
</section>

</body>
</html>
